generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  CUSTOMER
  AGENT
  SUPPLIER
  STAFF
  PROVIDER
}

enum BookingStatus {
  PENDING
  PAID
  ISSUED
  CANCELLED
  REFUNDED
}

model User {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  name      String
  role      UserRole @default(CUSTOMER)
  email     String?
  phone     String?
  balance   Float    @default(0)
  createdAt DateTime @default(now())
  profile   Profile?
  bookings  Booking[]
}

model Profile {
  id             String   @id @default(uuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id])
  birthDate      DateTime?
  nationality    String?
  savedPassports Json?    // Array of saved passengers
}

model Airline {
  id               String   @id @default(uuid())
  name             String
  iata             String   @unique
  logo             String?
  country          String?
  isActive         Boolean  @default(true)
  systemCommission Float    @default(0)
  flights          Flight[]
}

model Flight {
  id                String   @id @default(uuid())
  flightNumber      String
  airlineId         String
  airline           Airline  @relation(fields: [airlineId], references: [id])
  departureAirport  String
  arrivalAirport    String
  departureTime     DateTime
  arrivalTime       DateTime
  durationMinutes   Int
  economyPrice      Float
  businessPrice     Float
  firstPrice        Float
  economySeats      Int
  businessSeats     Int
  firstSeats        Int
  status            String   @default("active")
  createdAt         DateTime @default(now())
  bookings          Booking[]
}

model Booking {
  id                  String        @id @default(uuid())
  bookingRef          String        @unique
  flightId            String
  flight              Flight        @relation(fields: [flightId], references: [id])
  customerId          String
  customer            User          @relation(fields: [customerId], references: [id])
  passengerName       String
  passportNumber      String
  passportNationality String
  passportExpiry      DateTime
  status              BookingStatus @default(PENDING)
  totalAmount         Float
  paymentConfirmed    Boolean       @default(false)
  paymentMethod       String?
  createdAt           DateTime      @default(now())
  pnr                 String?
  ticketNumber        String?
}

model Account {
  id       String @id @default(uuid())
  name     String
  type     String // asset, liability, revenue, expense, equity
  balance  Float  @default(0)
  isSystem Boolean @default(false)
}
